<!DOCTYPE html><html lang="en"><head><title>src/RouteUtils.coffee</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/RouteUtils.coffee"><meta name="groc-project-path" content="src/RouteUtils.coffee.md"><meta name="groc-github-url" content="https://github.com/scanton/flaming-expresso"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/scanton/flaming-expresso/blob/master/src/RouteUtils.coffee.md">src/RouteUtils.coffee.md</a></div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="routeutilsclasslitcoffeelogohttpsrawgithubcomscantonflamingexpressomasterpublicimageslitcoffeeiconpng">RouteUtils (class) <img src="https://raw.github.com/scanton/flaming-expresso/master/public/images/litCoffee-icon.png" alt="litCoffee Logo" title="" /></h1>

<p>Since we have some extra requirements for our routing system,
we are not replacing the Express router (it is used by other parts)
of the application.  But our primary routing that includes
possible replicated website data, region-language data or other
parameters unique to our business requires a more active hand
on how the URI is parsed.</p>

<p>RouteUtils parses the requested URI and provides an abstracted api 
to work with the URI.</p>

<pre><code>module.exports = class RouteUtils

    @hasAssociate = false
    @assoc = ''
    @region = ''
    @language = ''
    @page = ''
    @index = ''
</code></pre>

<h2 id="constructor">constructor</h2>

<p>The constructor requires the following parameters</p>

<ul>
<li>@req - the Express req object</li>
<li>@regExLib - a reference to the RegExLibrary class</li>
<li><p>@serviceAdapter - a reference to a serviceAdapter such as the ProxyServiceAdapter class</p>

<pre><code>constructor: (@req, @regExLib, @serviceAdapter) -&gt;
    @init()
</code></pre></li>
</ul>

<h1 id="init">init</h1>

<p>We set up some inital properties that we will use in this class</p>

<ul>
<li>@argIndex will help us keep track of which URI parameters have already been identified, so we only focus on ones we are not sure of yet</li>
<li>@linkPath will hold the elements of our path used for the getLink function</li>
<li>@args will hold a list of arguments found in the URI</li>
<li><p>@path is and array of the request URI split by slashes '/'</p>

<pre><code>init: -&gt;
    @argIndex = 0
    @linkPath = []
    @args = []
    @path = @req.path.split '/'
</code></pre></li>
</ul>

<p>In most cases, the first item in this list will always be an empty
string.  If it is, we shift it out of the array to keep from dealing
with it.</p>

<pre><code>        if @path[0] == ''
            @path.shift()
</code></pre>

<p>We use our RegExLibrary to test elements in the @path array as
possible parameters.  The first one we test is if the first element
contains associate replicated website data.</p>

<pre><code>        if @regExLib.assoc.test @path[0]
</code></pre>

<p>We have a string that could be associate data, so we pass it to
the getAssoc method of @serviceAdapter.  </p>

<pre><code>            assocData = @serviceAdapter.getAssoc @path[0]
            if assocData
</code></pre>

<p>If we have valid associate website data, then we know this is a replicated website, so we save our data, update @argIndex to indicate that the first element in the @path has been determined.</p>

<pre><code>                @assoc = @path[0]
                @argIndex = 1
                @hasAssociate = true
                @assocData = assocData
                @linkPath.push @assoc
</code></pre>

<h2 id="getlink">getLink</h2>

<p>This method is used in links throughout the application to render paths with associate and region-language data.  We will probably create a shorter reference to this method in the main application.</p>

<pre><code>    getLink: (link) -&gt;
        return "#{@linkPath.join('/')}/#{link}"
</code></pre></div></div></div></div></body></html>